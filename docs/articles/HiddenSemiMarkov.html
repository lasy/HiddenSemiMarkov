<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to `HiddenSemiMarkov` • HiddenSemiMarkov</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to `HiddenSemiMarkov`">
<meta property="og:description" content="HiddenSemiMarkov">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">HiddenSemiMarkov</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/HiddenSemiMarkov.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="HiddenSemiMarkov_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="HiddenSemiMarkov_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="HiddenSemiMarkov_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to <code>HiddenSemiMarkov</code>
</h1>
            
      
      
      <div class="hidden name"><code>HiddenSemiMarkov.Rmd</code></div>

    </div>

    
    
<p><strong>Introduction</strong></p>
<p>This document provides an introduction to the <code>HiddenSemiMarkov</code> package, which allows the specification and fitting of hidden semi-Markov models and to predict the sequence of hidden state for multivariate time-series with variable- and state-dependent missing probabilities. This package was especially developed to decode time-series in which variables are of different type (continuous, discrete or categorical) and which may be missing with different probabilities. In this document, we first introduce the main functions of this package. We then use examples of increasing complexity to demonstrate the use of these functions and their options.</p>
<div id="main-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#main-functions" class="anchor"></a>Main functions</h2>
<p>This package comes with 4 main functions which can be used to specify a model (<code><a href="../reference/specify_hsmm.html">specify_hsmm()</a></code>), simulate sequences from a model (<code><a href="../reference/simulate_hsmm.html">simulate_hsmm()</a></code>), predict the hidden states given a sequence of observations (<code>predict_state_hsmm()</code>), and fit a model to sequences of observation (<code><a href="../reference/fit_hsmm.html">fit_hsmm()</a></code>). They are detailed below and demonstrated in the next sections.</p>
<ul>
<li><p><code><a href="../reference/specify_hsmm.html">specify_hsmm()</a></code>: Model specification. Takes as input the number of states (<code>J</code>), the model graph and transition probabilities (<code>trans</code>), the sojourn distribution (<code>sojourn</code>), the emission parameter (<code>emission.par</code>). Optional inputs include a data augmentation function (<code>augment_data_fun</code>), names and colors associated with each states (<code>state_names</code> and <code>state_colors</code>). Returns a list of class <code>hsmm</code>.</p></li>
<li><p><code><a href="../reference/simulate_hsmm.html">simulate_hsmm()</a></code>: Simulate data given a <code>hsmm</code> model. The length or number of state transition can be specified as input.</p></li>
<li>
<p><code>predict_hsmm_states()</code>: Sequence decoding. Takes as input a <code>hsmm</code> model and one or more sequences of observations (<code>X</code>) and returns the decoded state sequence. Two methods are available for the decoding:</p>
<ul>
<li><p>Viterbi algorithm (<code>method = "viterbi"</code>): returns the most likely sequence of state given the whole sequence of the observations.</p></li>
<li><p>Forward-Backward algorithm (<code>method = "smoothed"</code>): returns the probability of each state at each time-point given the whole sequence of observation.</p></li>
</ul>
</li>
<li>
<p><code><a href="../reference/fit_hsmm.html">fit_hsmm()</a></code>: Fits an <code>hsmm</code> model to increase the likelihood of decoding a provided sequence. This function uses on an EM approach.</p>
<ul>
<li><p>At the E-step, the sequence is decoded with the current model parameters (initial and transition probabilities, sojourn distributions and emission distributions) with the Forward-Backward algorithm.</p></li>
<li><p>At the M-step, the model parameters are re-estimated based on the posterior state probabilities returned in the E-steps.</p></li>
</ul>
</li>
</ul>
<p>These functions are demonstrated in the sections below with several examples.</p>
<div id="visualization-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#visualization-functions" class="anchor"></a>Visualization functions</h3>
<p>The package also comes with a series of visualization functions</p>
<ul>
<li><p><code><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq()</a></code> plots a sequence of observations. If states are provided with the sequence, the state sequences are plotted on top of the observations. Several state sequences can be provided (e.g. the ground truth and the decoded state sequence). If two state sequences are provided, the function automatically displays the difference between the two state sequence in addition to the two state sequences.</p></li>
<li><p><code><a href="../reference/plot_hsmm_marg_dist.html">plot_hsmm_marg_dist()</a></code> plots the marginal distributions <span class="math inline">\(\Pr(X_k|S_j)\)</span> of each variable in each state. The transparency of the histograms is proportional to the probability for this variable to be observed in a given state.</p></li>
<li><p><code><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist()</a></code> plots the sojourn distributions of each states.</p></li>
<li><p><code><a href="../reference/plot_hsmm_transitions.html">plot_hsmm_transitions()</a></code> plots the model graph with edges width proportional to the transition probabilities between two states.</p></li>
</ul>
<p>See sections below for examples of these functions.</p>
</div>
<div id="manual-labelling-validation-of-decoding-shiny-app-" class="section level3">
<h3 class="hasAnchor">
<a href="#manual-labelling-validation-of-decoding-shiny-app-" class="anchor"></a>Manual labelling / validation of decoding shiny app.</h3>
<p>Finally, the function <code><a href="../reference/label_sequences.html">label_sequences()</a></code> calls an interactive app that opens in a web browser and can be used to add manual labels to sequences. It can also be used to validate an existing decoding (<em>e.g.</em> results from <code>predict_hsmm_states()</code>).</p>
</div>
</div>
<div id="example-1-a-simple-2-state-3-variable-model-with-no-missing-data-" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-a-simple-2-state-3-variable-model-with-no-missing-data-" class="anchor"></a>Example 1: a simple 2-state, 3-variable model with no missing data.</h2>
<div id="model-specification" class="section level3">
<h3 class="hasAnchor">
<a href="#model-specification" class="anchor"></a>Model specification</h3>
<p>The specification of a hidden semi-Markov model requires the number of state, the initial probabilities (i.e. the probability for each state to start a state sequence), the transition probabilities (i.e. the probabilities to switch from one state to another), the sojourn distributions for each state (parametric or non-parametric distributions) and the marginal emission probabilities (i.e. the distributions of values of each variables in each state). Note that, while we do not specify joint distributions for the different values, potential within-state dependencies between variables can be learned at the initialization step if labeled data is provided or when fitting the model to sequences.</p>
<p>We will here use a simple 2-state 3-variable toy model to provide an example of a model specification. We temporarily use a list to store the model parameters before the actual use of the <code><a href="../reference/specify_hsmm.html">specify_hsmm()</a></code> function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1_param_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><strong>States</strong></p>
<p><code>J</code> is the number of states of the model. We define a model with two hidden states.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1_param_list</span><span class="op">$</span><span class="va">J</span> <span class="op">=</span> <span class="fl">2</span></code></pre></div>
<p>(Optional) These states can be names, <em>e.g.</em> “A” and “B”, and be allocated specific colors.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1_param_list</span><span class="op">$</span><span class="va">state_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span><span class="op">)</span>
<span class="va">m1_param_list</span><span class="op">$</span><span class="va">state_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seagreen1"</span>,<span class="st">"slategray"</span><span class="op">)</span></code></pre></div>
<p><strong>Initial and transition probabilities</strong></p>
<p>Initial probabilities are defined as a vector of length <code>J</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1_param_list</span><span class="op">$</span><span class="va">init</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.1</span><span class="op">)</span></code></pre></div>
<p>Transition probabilities are defined as a (<code>J</code> x <code>J</code>) matrix where the rows are the <code>'from'</code> states and the columns are the <code>'to'</code> states. Rows must sum to 1 and the diagonal must be filled with zeros as the probabilities of staying in a given state is defined in the sojourn distributions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1_param_list</span><span class="op">$</span><span class="va">trans</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">m1_param_list</span><span class="op">$</span><span class="va">J</span>, ncol <span class="op">=</span> <span class="va">m1_param_list</span><span class="op">$</span><span class="va">J</span><span class="op">)</span></code></pre></div>
<p><strong>Sojourn distributions</strong></p>
<p>Sojourn distributions can be defined as parametric or non-parametric distributions. Supported distributions are provided in the table below.</p>
<table class="table">
<caption>
Supported sojourn distributions
</caption>
<thead><tr>
<th style="text-align:left;">
distribution_type
</th>
<th style="text-align:left;">
parameters
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
nonparametric
</td>
<td style="text-align:left;">
d
</td>
</tr>
<tr>
<td style="text-align:left;">
ksmoothed_nonparametric
</td>
<td style="text-align:left;">
d
</td>
</tr>
<tr>
<td style="text-align:left;">
gamma
</td>
<td style="text-align:left;">
shape, scale
</td>
</tr>
<tr>
<td style="text-align:left;">
poisson
</td>
<td style="text-align:left;">
shift, lambda
</td>
</tr>
<tr>
<td style="text-align:left;">
lnorm
</td>
<td style="text-align:left;">
meanlog, sdlog
</td>
</tr>
<tr>
<td style="text-align:left;">
logarithmic
</td>
<td style="text-align:left;">
shape
</td>
</tr>
<tr>
<td style="text-align:left;">
nbinom
</td>
<td style="text-align:left;">
size, mu or prob, shift
</td>
</tr>
</tbody>
</table>
<p>Sojourn distributions are specified by a list. This list can either have one element per state if states are described by different distribution type or with a more compact list if all states can be described by the same distribution family with different parameters for each state. Here we demonstrate the latter case but additional examples are found in the next sections.</p>
<p>When specifying the sojourns with the same distribution family for all states, the list starts with a <code>'type'</code> element whose value is a string specifying the type of sojourn distributions. The other elements of the list specify the parameters of the distributions and their name depends on the distribution type chosen. If the sojourn is specified as a non-parametric distribution, the other element in the list is a matrix <code>d</code> of dimension (<code>M</code> x <code>J</code>) where <code>M</code> is the length of the longest sojourn.</p>
<p>Here, we define the sojourn distributions of the toy model as <code>gamma</code> distributions.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">m1_param_list</span><span class="op">$</span><span class="va">sojourn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"gamma"</span>,
                   shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">10</span><span class="op">)</span>, 
                   <span class="co"># the shape of the gamma distribution of state 1 is 2,  </span>
                   <span class="co"># and the shape for state 2 is 10</span>
                   scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">3</span><span class="op">)</span>
                   <span class="co"># the scale is 10 for the state 1 distribution and</span>
                   <span class="co"># is 3 for the state 2 distribution</span>
                   <span class="op">)</span></code></pre></div>
<p><strong>Emission parameters</strong></p>
<p>Because we wanted the package to be able to decode time-series with variables of different types (continuous, discrete, binary and categorical), the emission probabilities are provided independently for each variable. This makes the assumption that the variables are independent within a given state. However, potential within-state dependencies may be learned when fitting the model to data.</p>
<p>The marginal emission distributions <span class="math inline">\(\Pr(X_k|S_j)\)</span> can be described as parametric (continuous or discrete) or non-parametric (e.g. for categorical variables). Currently, the package supports normal (<code>norm</code>), beta (<code>beta</code>), binomial (<code>binom</code>) and non-parametric (<code>non-par</code>) distributions.</p>
<p>To check the currently supported emission distribution and how to specify them, one can use the function <code><a href="../reference/available_marginal_emission_dist.html">available_marginal_emission_dist()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="../reference/available_marginal_emission_dist.html">available_marginal_emission_dist</a></span><span class="op">(</span><span class="op">)</span>,
      booktab <span class="op">=</span> <span class="cn">TRUE</span>,
      format <span class="op">=</span> <span class="st">"html"</span>,
      caption <span class="op">=</span> <span class="st">"Available marginal emission distributions"</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>
Available marginal emission distributions
</caption>
<thead><tr>
<th style="text-align:left;">
type
</th>
<th style="text-align:left;">
distribution
</th>
<th style="text-align:left;">
params
</th>
<th style="text-align:left;">
parameter_type
</th>
<th style="text-align:left;">
parameter_size
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
continuous
</td>
<td style="text-align:left;">
norm
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
double
</td>
<td style="text-align:left;">
J
</td>
</tr>
<tr>
<td style="text-align:left;">
continuous
</td>
<td style="text-align:left;">
norm
</td>
<td style="text-align:left;">
sd
</td>
<td style="text-align:left;">
double
</td>
<td style="text-align:left;">
J
</td>
</tr>
<tr>
<td style="text-align:left;">
continuous
</td>
<td style="text-align:left;">
beta
</td>
<td style="text-align:left;">
shape1
</td>
<td style="text-align:left;">
double &gt;=0
</td>
<td style="text-align:left;">
J
</td>
</tr>
<tr>
<td style="text-align:left;">
continuous
</td>
<td style="text-align:left;">
beta
</td>
<td style="text-align:left;">
shape2
</td>
<td style="text-align:left;">
double &gt;=0
</td>
<td style="text-align:left;">
J
</td>
</tr>
<tr>
<td style="text-align:left;">
discrete
</td>
<td style="text-align:left;">
binom
</td>
<td style="text-align:left;">
size
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
J
</td>
</tr>
<tr>
<td style="text-align:left;">
discrete
</td>
<td style="text-align:left;">
binom
</td>
<td style="text-align:left;">
prob
</td>
<td style="text-align:left;">
double [0,1]
</td>
<td style="text-align:left;">
J
</td>
</tr>
<tr>
<td style="text-align:left;">
categorical
</td>
<td style="text-align:left;">
non-par
</td>
<td style="text-align:left;">
values
</td>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
NV
</td>
</tr>
<tr>
<td style="text-align:left;">
categorical
</td>
<td style="text-align:left;">
non-par
</td>
<td style="text-align:left;">
probs
</td>
<td style="text-align:left;">
double [0,1]
</td>
<td style="text-align:left;">
NV x J
</td>
</tr>
</tbody>
</table>
<p>For our m1 model, we define three variables, each of a different distribution family.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">m1_param_list</span><span class="op">$</span><span class="va">emission_dist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  var1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    type <span class="op">=</span> <span class="st">"norm"</span>,
    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,
      sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.2</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  var2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    type <span class="op">=</span> <span class="st">"binom"</span>,
    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,
      prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.8</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  var3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    type <span class="op">=</span> <span class="st">"non-par"</span>,
    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>,<span class="st">"d"</span><span class="op">)</span>,
      probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.7</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,
                       <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span>, <span class="fl">4</span>,<span class="va">m1_param_list</span><span class="op">$</span><span class="va">J</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><strong>Model specification</strong></p>
<p>We can now specify the model with the <code><a href="../reference/specify_hsmm.html">specify_hsmm()</a></code> function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">m1</span> <span class="op">=</span> <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="va">m1_param_list</span><span class="op">$</span><span class="va">J</span>,
  state_names <span class="op">=</span> <span class="va">m1_param_list</span><span class="op">$</span><span class="va">state_names</span>,
  state_colors <span class="op">=</span> <span class="va">m1_param_list</span><span class="op">$</span><span class="va">state_colors</span>,
  init <span class="op">=</span> <span class="va">m1_param_list</span><span class="op">$</span><span class="va">init</span>,
  transition <span class="op">=</span> <span class="va">m1_param_list</span><span class="op">$</span><span class="va">trans</span>,
  sojourn <span class="op">=</span> <span class="va">m1_param_list</span><span class="op">$</span><span class="va">sojourn</span>,
  marg_em_probs <span class="op">=</span> <span class="va">m1_param_list</span><span class="op">$</span><span class="va">emission_dist</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>
<span class="co">#&gt; [1] "hsmm"</span></code></pre></div>
<p><strong>Visualization of the specified model</strong></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="../reference/plot_hsmm_transitions.html">plot_hsmm_transitions</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Transitions"</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/m1-trans-viz-1.png" width="288"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sojourn distributions"</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/m1-sojourn-viz-1.png" width="480"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="../reference/plot_hsmm_marg_dist.html">plot_hsmm_marg_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1</span>, show_missing_probs <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Marginal emission distributions"</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/m1-em-dist-viz-1.png" width="480"></p>
</div>
<div id="sequence-simulation" class="section level3">
<h3 class="hasAnchor">
<a href="#sequence-simulation" class="anchor"></a>Sequence simulation</h3>
<p>Now that we have specified our model, we can simulate sequences with the <code><a href="../reference/simulate_hsmm.html">simulate_hsmm()</a></code> function.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1</span>, n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></code></pre></div>
<p>We can visualize the simulated sequence with the <code><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq()</a></code> function.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, model <span class="op">=</span> <span class="va">m1</span>, 
              add_state_color_legend <span class="op">=</span> <span class="cn">TRUE</span>, 
              title <span class="op">=</span> <span class="st">"Sequence simulated from m1"</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/m1-sim-data-viz-1.png" width="672"> And get a compact view (heatmap) of the sequence with the option <code>compact_view</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, model <span class="op">=</span> <span class="va">m1</span>, 
              compact_view <span class="op">=</span> <span class="cn">TRUE</span>, 
              title <span class="op">=</span> <span class="st">"Sequence simulated from m1 (compact view)"</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/m1-sim-data-viz-compact-1.png" width="672"></p>
</div>
<div id="sequence-decoding" class="section level3">
<h3 class="hasAnchor">
<a href="#sequence-decoding" class="anchor"></a>Sequence decoding</h3>
<p>There are two methods available to infer the sequence of hidden state: the Viterbi method, which provides the most likely hidden state sequence, and the Forward-Backward method, which provides the state probabilities at each time-point.</p>
<p>Both methods are available in the <code><a href="../reference/predict_states_hsmm.html">predict_states_hsmm()</a></code> function, accessible with the <code>method</code> argument.</p>
<p><code>predict_hsmm_states()</code> returns a list with three tables:</p>
<ol style="list-style-type: decimal">
<li>
<p><code>state_seq</code> a data.frame with three columns:</p>
<ul>
<li><p><code>seq_id</code> (the ID of the sequences, same as in <code>X</code>),</p></li>
<li><p><code>t</code> the time-point (same as in <code>X</code>) and</p></li>
<li><p><code>state</code> the most probable hidden state at that time-points.</p></li>
</ul>
</li>
<li>
<p><code>loglik</code> a data.frame with two columns:</p>
<ul>
<li><p><code>seq_id</code></p></li>
<li><p><code>ll</code> the log-likelihood of the decoding for that sequence</p></li>
</ul>
</li>
<li>
<p><code>probabilities</code>, a table of 4 (Viterbi) or 5 (Forward-Backward) columns:</p>
<ul>
<li><p><code>seq_id</code></p></li>
<li><p><code>t</code></p></li>
<li><p><code>state</code></p></li>
<li><p><code>obs_prob</code>: the probability of the observations in that state (i.e. <span class="math inline">\(\Pr(X_i| S_j)\)</span>)</p></li>
<li><p><code>state_prob</code> (only when calling the function with the <code>FwBw</code> method) : the state probability given the whole observation sequence (i.e. <span class="math inline">\(\Pr(S_j| X)\)</span>)</p></li>
</ul>
</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">viterbi</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_states_hsmm.html">predict_states_hsmm</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, model <span class="op">=</span> <span class="va">m1</span>, method <span class="op">=</span> <span class="st">"Viterbi"</span><span class="op">)</span>

<span class="va">fwbw</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_states_hsmm.html">predict_states_hsmm</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, model <span class="op">=</span> <span class="va">m1</span>, method <span class="op">=</span> <span class="st">"FwBw"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>
  X <span class="op">=</span> <span class="va">X</span> <span class="op">%&gt;%</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, 
                      <span class="va">viterbi</span><span class="op">$</span><span class="va">state_seq</span> <span class="op">%&gt;%</span> 
                        <span class="fu">select</span><span class="op">(</span><span class="va">seq_id</span>, <span class="va">t</span>, <span class="va">state</span><span class="op">)</span> <span class="op">%&gt;%</span> 
                        <span class="fu">rename</span><span class="op">(</span>state_Viterbi <span class="op">=</span> <span class="va">state</span><span class="op">)</span>,
                      by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seq_id"</span>,<span class="st">"t"</span><span class="op">)</span><span class="op">)</span>,
  model <span class="op">=</span> <span class="va">m1</span>,
  title <span class="op">=</span> <span class="st">"Hidden state sequence predicted with the Viterbi algorithm"</span>
<span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/m1-seq-decoding-viz-1.png" width="768"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>
  X <span class="op">=</span> <span class="va">X</span> <span class="op">%&gt;%</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, 
                      <span class="va">fwbw</span><span class="op">$</span><span class="va">state_seq</span> <span class="op">%&gt;%</span> 
                        <span class="fu">select</span><span class="op">(</span><span class="va">seq_id</span>, <span class="va">t</span>, <span class="va">state</span><span class="op">)</span> <span class="op">%&gt;%</span> 
                        <span class="fu">rename</span><span class="op">(</span>state_FwBw <span class="op">=</span> <span class="va">state</span><span class="op">)</span>,
                      by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seq_id"</span>,<span class="st">"t"</span><span class="op">)</span><span class="op">)</span>,
  model <span class="op">=</span> <span class="va">m1</span>,
  title <span class="op">=</span> <span class="st">"Hidden state sequence predicted with the Forward-Backward algorithm"</span>
<span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/m1-seq-decoding-viz-2.png" width="768"></p>
</div>
<div id="fitting-a-hsmm-model" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-a-hsmm-model" class="anchor"></a>Fitting a HSMM model</h3>
<p>The <code><a href="../reference/fit_hsmm.html">fit_hsmm()</a></code> function can be used to fit a model to a sequence or a series of sequences. This means that the model parameters (initial probabilities, transition probabilities, sojourn distributions and emission distributions) are adjusted so that the likelihood of the sequences is maximized. The <code><a href="../reference/fit_hsmm.html">fit_hsmm()</a></code> function relies on the EM (expectation maximization) algorithm in which the E-step followed the M-step are repeated until the change in likelihood is marginal. In the E-step, the sequences are decoded using the Forward-Backward algorithm so that the probabilities of each hidden state are computed. In the M-step, the model parameters are adjusted using these probabilities to maximize the likelihood of the observations.</p>
<p>To demonstrate this function, we modify the simulated sequence and fit the model to this modified sequence.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">Xmod</span> <span class="op">=</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">X</span>, <span class="va">X</span><span class="op">)</span> <span class="co"># we repeat the sequence to have a longer sequence</span>
<span class="va">j</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Xmod</span><span class="op">$</span><span class="va">state</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span> <span class="co"># we remove time-points from the state 2 to modify the sojourn distributions</span>
<span class="va">Xmod</span> <span class="op">=</span> <span class="va">Xmod</span><span class="op">[</span><span class="op">-</span><span class="va">j</span>,<span class="op">]</span>
<span class="va">Xmod</span><span class="op">$</span><span class="va">t</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Xmod</span><span class="op">)</span>
<span class="va">Xmod</span><span class="op">$</span><span class="va">var2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Xmod</span><span class="op">$</span><span class="va">state</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span>


<span class="va">fit_results</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">Xmod</span>, model <span class="op">=</span> <span class="va">m1</span><span class="op">)</span>

<span class="fu"><a href="../reference/plot_hsmm_fit_status.html">plot_hsmm_fit_status</a></span><span class="op">(</span>fit_output <span class="op">=</span> <span class="va">fit_results</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/m1-fit-1.png" width="700"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sojourn distribution of the specified model"</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/m1-fit-comparison-1.png" width="576"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">fit_results</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sojourn distribution of the fitted model"</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/m1-fit-comparison-2.png" width="576"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="../reference/plot_hsmm_marg_dist.html">plot_hsmm_marg_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Marginal emission distribution of the specified model"</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/m1-fit-comparison-3.png" width="576"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_hsmm_marg_dist.html">plot_hsmm_marg_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">fit_results</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Marginal emission distribution of the fitted model"</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/m1-fit-comparison-4.png" width="576"></p>
</div>
</div>
<div id="example-2-specifying-sojourns" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-specifying-sojourns" class="anchor"></a>Example 2: Specifying sojourns</h2>
<p>In this section, we look at how sojourn distributions can be specified. In this package, they can be specified as parametric or non-parametric distributions. Several parametric distributions are supported such as Gamma, Poisson, negative binomial, etc. In addition, sojourns can be specified such as they follow the same type of distribution in all states (<em>e.g.</em> the sojourns of all states follow a Gamma distribution) or with distinct distributions for each state (<em>e.g.</em> the sojourns of one state follow a gamma distribution while the sojourn of another state follow a shifted poisson distribution). We illustrate these differences with examples below.</p>
<p>The list of currently supported sojourn distribution is available by typing:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/available_sojourn_dist.html">available_sojourn_dist</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;         distribution_type              parameters</span>
<span class="co">#&gt; 1           nonparametric                       d</span>
<span class="co">#&gt; 2 ksmoothed_nonparametric                       d</span>
<span class="co">#&gt; 3                   gamma            shape, scale</span>
<span class="co">#&gt; 4                 poisson           shift, lambda</span>
<span class="co">#&gt; 5                   lnorm          meanlog, sdlog</span>
<span class="co">#&gt; 6             logarithmic                   shape</span>
<span class="co">#&gt; 7                  nbinom size, mu or prob, shift</span></code></pre></div>
<div id="parametric-vs-non-parametric-sojourns-" class="section level3">
<h3 class="hasAnchor">
<a href="#parametric-vs-non-parametric-sojourns-" class="anchor"></a>Parametric vs non-parametric sojourns.</h3>
<p>Here, we specify three models: <code>ms1</code>, <code>ms2</code> and <code>ms3</code>. In <code>ms1</code>, the sojourn distributions are specified as Gamma distributions, while in <code>ms2</code> and <code>ms2</code>, they are specified as non-parametric and k-smoothed non-parametric distributions. Both non-parametric distributions are specified with the exact same shape than the Gamma distribution such that the sojourn distributions are effectively identical for all three models.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">ms1_param_list</span> <span class="op">=</span> <span class="va">m1</span>
<span class="va">ms1_param_list</span><span class="op">$</span><span class="va">sojourn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"gamma"</span>,
                             shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">10</span><span class="op">)</span>,
                             scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">ms1</span> <span class="op">=</span> <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="va">ms1_param_list</span><span class="op">$</span><span class="va">J</span>,
  state_names <span class="op">=</span> <span class="va">ms1_param_list</span><span class="op">$</span><span class="va">state_names</span>,
  state_colors <span class="op">=</span> <span class="va">ms1_param_list</span><span class="op">$</span><span class="va">state_colors</span>,
  init <span class="op">=</span> <span class="va">ms1_param_list</span><span class="op">$</span><span class="va">init</span>, 
  transition <span class="op">=</span> <span class="va">ms1_param_list</span><span class="op">$</span><span class="va">transition</span>,
  sojourn <span class="op">=</span> <span class="va">ms1_param_list</span><span class="op">$</span><span class="va">sojourn</span>,
  marg_em_probs <span class="op">=</span> <span class="va">ms1_param_list</span><span class="op">$</span><span class="va">marg_em_probs</span><span class="op">)</span>


<span class="va">ms2_param_list</span> <span class="op">=</span> <span class="va">m1</span>
<span class="va">ms2_param_list</span><span class="op">$</span><span class="va">sojourn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"nonparametric"</span>,
                    d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, shape <span class="op">=</span> <span class="fl">2</span>, scale <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,
                              <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, shape <span class="op">=</span> <span class="fl">10</span>, scale <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">ms2</span> <span class="op">=</span> <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="va">ms2_param_list</span><span class="op">$</span><span class="va">J</span>,
  state_names <span class="op">=</span> <span class="va">ms2_param_list</span><span class="op">$</span><span class="va">state_names</span>,
  state_colors <span class="op">=</span> <span class="va">ms2_param_list</span><span class="op">$</span><span class="va">state_colors</span>,
  init <span class="op">=</span> <span class="va">ms2_param_list</span><span class="op">$</span><span class="va">init</span>, 
  transition <span class="op">=</span> <span class="va">ms2_param_list</span><span class="op">$</span><span class="va">transition</span>,
  sojourn <span class="op">=</span> <span class="va">ms2_param_list</span><span class="op">$</span><span class="va">sojourn</span>,
  marg_em_probs <span class="op">=</span> <span class="va">ms2_param_list</span><span class="op">$</span><span class="va">marg_em_probs</span><span class="op">)</span>
<span class="co">#&gt; Warning in .check_sojourn_all_states(sojourn, J): The provided sojourn</span>
<span class="co">#&gt; distributions do not sum to 1 for at least one state. Sojourn distributions are</span>
<span class="co">#&gt; normalized so that they sum to 1.</span>


<span class="va">ms3_param_list</span> <span class="op">=</span> <span class="va">m1</span>
<span class="va">ms3_param_list</span><span class="op">$</span><span class="va">sojourn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"ksmoothed_nonparametric"</span>,
                    d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, shape <span class="op">=</span> <span class="fl">2</span>, scale <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,
                              <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, shape <span class="op">=</span> <span class="fl">10</span>, scale <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">ms3</span> <span class="op">=</span> <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="va">ms3_param_list</span><span class="op">$</span><span class="va">J</span>,
  state_names <span class="op">=</span> <span class="va">ms3_param_list</span><span class="op">$</span><span class="va">state_names</span>,
  state_colors <span class="op">=</span> <span class="va">ms3_param_list</span><span class="op">$</span><span class="va">state_colors</span>,
  init <span class="op">=</span> <span class="va">ms3_param_list</span><span class="op">$</span><span class="va">init</span>, 
  transition <span class="op">=</span> <span class="va">ms3_param_list</span><span class="op">$</span><span class="va">transition</span>,
  sojourn <span class="op">=</span> <span class="va">ms3_param_list</span><span class="op">$</span><span class="va">sojourn</span>,
  marg_em_probs <span class="op">=</span> <span class="va">ms3_param_list</span><span class="op">$</span><span class="va">marg_em_probs</span><span class="op">)</span>
<span class="co">#&gt; Warning in .check_sojourn_all_states(sojourn, J): The provided sojourn</span>
<span class="co">#&gt; distributions do not sum to 1 for at least one state. Sojourn distributions are</span>
<span class="co">#&gt; normalized so that they sum to 1.</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span><span class="va">ms1</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sojourns specified as Gamma distributions"</span><span class="op">)</span>
<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span><span class="va">ms2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sojourns specified as non-parametric distributions"</span><span class="op">)</span>
<span class="va">g3</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span><span class="va">ms3</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sojourns specified as k-smoothed non-parametric distributions"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, <span class="va">g3</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/ms1-2-3-sojourn-viz-1.png" width="672"></p>
<p>When we simulate sequences with these three models with the same seed, we obtain virtually the same sequence of states and observations.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">X1</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms1</span>, seed <span class="op">=</span> <span class="fl">10</span>, n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="va">X2</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms2</span>, seed <span class="op">=</span> <span class="fl">10</span>, n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="va">X3</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms3</span>, seed <span class="op">=</span> <span class="fl">10</span>, n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>

<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X1</span>, model <span class="op">=</span> <span class="va">ms1</span>, compact_view <span class="op">=</span> <span class="cn">TRUE</span>, 
                   title <span class="op">=</span> <span class="st">"Sojourns specified as Gamma distributions"</span><span class="op">)</span>
<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X2</span>, model <span class="op">=</span> <span class="va">ms2</span>, compact_view <span class="op">=</span> <span class="cn">TRUE</span>,
                   title <span class="op">=</span> <span class="st">"Sojourns specified as non-parametric distributions"</span><span class="op">)</span>
<span class="va">g3</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X3</span>, model <span class="op">=</span> <span class="va">ms3</span>, compact_view <span class="op">=</span> <span class="cn">TRUE</span>,
                   title <span class="op">=</span> <span class="st">"Sojourns specified as k-smoothed non-parametric distributions"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, <span class="va">g3</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/ms1-2-3-simulate-1.png" width="768"></p>
<p>However, when we fit the model to these sequences, the updated (fitted) sojourn distributions are different because the sojourns of model <code>ms1</code> are constrained to be described by Gamma distributions, while the sojourns of models <code>ms2</code> and <code>ms3</code> are unconstrained. In model <code>ms3</code>, the distributions are kept smooth but are not constrained to follow any specific distribution.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">ms1_fitted</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms1</span>, X <span class="op">=</span> <span class="va">X1</span><span class="op">)</span>
<span class="va">ms2_fitted</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms2</span>, X <span class="op">=</span> <span class="va">X1</span><span class="op">)</span>
<span class="va">ms3_fitted</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms3</span>, X <span class="op">=</span> <span class="va">X1</span><span class="op">)</span>

<span class="va">g0</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Specified sojourn distributions"</span><span class="op">)</span>
<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms1_fitted</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Fitted sojourn distributions specified as Gamma distributions"</span><span class="op">)</span>
<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms2_fitted</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Fitted sojourn distributions specified as non-parametric distributions"</span><span class="op">)</span>
<span class="va">g3</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms3_fitted</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Fitted sojourn distributions specified as k-smoothed non-parametric distributions"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g0</span>, <span class="va">g1</span>, <span class="va">g2</span>, <span class="va">g3</span>, nrow <span class="op">=</span> <span class="fl">4</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/ms1-2-3-fit-1.png" width="672"></p>
</div>
<div id="using-bayesian-updating-when-re-estimating-the-sojourn-distributions" class="section level3">
<h3 class="hasAnchor">
<a href="#using-bayesian-updating-when-re-estimating-the-sojourn-distributions" class="anchor"></a>Using Bayesian updating when re-estimating the sojourn distributions</h3>
<p>Depending on the confidence that one has on the specified sojourn distributions, it may be useful to use the specified distribution as prior on the sojourn distributions when fitting a model to a sequence of data. We show here the impact of using such a prior on the fitted sojourn distributions.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">ms1_fitted_prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms1</span>, X <span class="op">=</span> <span class="va">X1</span>, use_sojourn_prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">ms2_fitted_prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms2</span>, X <span class="op">=</span> <span class="va">X1</span>, use_sojourn_prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">ms3_fitted_prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms3</span>, X <span class="op">=</span> <span class="va">X1</span>, use_sojourn_prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">g1_no_prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span>  <span class="va">ms1_fitted</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Gamma sojourn distributions fitted without prior"</span><span class="op">)</span>
<span class="va">g1_prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms1_fitted_prior</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Gamma sojourn distributions fitted with prior"</span><span class="op">)</span>
<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g1_no_prior</span>, <span class="va">g1_prior</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/ms1-2-3-sojourn-prior-1.png" width="768"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="va">g2_no_prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span>  <span class="va">ms2_fitted</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Non-parametric sojourn distributions fitted without prior"</span><span class="op">)</span>
<span class="va">g2_prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms2_fitted_prior</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Non-parametric sojourn distributions fitted with prior"</span><span class="op">)</span>
<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g2_no_prior</span>, <span class="va">g2_prior</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/ms1-2-3-sojourn-prior-2.png" width="768"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="va">g3_no_prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span>  <span class="va">ms3_fitted</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"K-smoothed non-parametric sojourn distributions fitted without prior"</span><span class="op">)</span>
<span class="va">g3_prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">ms3_fitted_prior</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"K-smoothed non-parametric sojourn distributions fitted with prior"</span><span class="op">)</span>
<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g3_no_prior</span>, <span class="va">g3_prior</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/ms1-2-3-sojourn-prior-3.png" width="768"></p>
</div>
<div id="different-sojourn-distribution-families-for-each-state" class="section level3">
<h3 class="hasAnchor">
<a href="#different-sojourn-distribution-families-for-each-state" class="anchor"></a>Different sojourn distribution families for each state</h3>
<p>While non-parametric distributions allow for drastically different distributions for each state, it may be convenient to constrain the sojourn distributions to distribution families specific to each state.</p>
<p>Here, we define two models: <code>msd1</code> and <code>msd2</code>. The sojourns of <code>msd1</code> are specified as Gamma distributions for both state, while the sojourns of the <code>msd2</code> are specified as a Poisson for the first state and a Gamma for the second state. The parameters of the sojourn distributions are chosen such that the specified distributions of both models are very similar.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">msd1_param_list</span> <span class="op">=</span> <span class="va">m1</span>
<span class="va">msd1_param_list</span><span class="op">$</span><span class="va">sojourn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"gamma"</span>,
                    shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>,
                    scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">msd1</span> <span class="op">=</span> <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="va">msd1_param_list</span><span class="op">$</span><span class="va">J</span>,
  state_names <span class="op">=</span> <span class="va">msd1_param_list</span><span class="op">$</span><span class="va">state_names</span>,
  state_colors <span class="op">=</span> <span class="va">msd1_param_list</span><span class="op">$</span><span class="va">state_colors</span>,
  init <span class="op">=</span> <span class="va">msd1_param_list</span><span class="op">$</span><span class="va">init</span>, 
  transition <span class="op">=</span> <span class="va">msd1_param_list</span><span class="op">$</span><span class="va">transition</span>,
  sojourn <span class="op">=</span> <span class="va">msd1_param_list</span><span class="op">$</span><span class="va">sojourn</span>,
  marg_em_probs <span class="op">=</span> <span class="va">msd1_param_list</span><span class="op">$</span><span class="va">marg_em_probs</span><span class="op">)</span>


<span class="va">msd2_param_list</span> <span class="op">=</span> <span class="va">m1</span>
<span class="va">msd2_param_list</span><span class="op">$</span><span class="va">sojourn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"poisson"</span>, lambda <span class="op">=</span> <span class="fl">1</span>, shift <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"gamma"</span>, shape <span class="op">=</span> <span class="fl">10</span>, scale <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">msd2</span> <span class="op">=</span> <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="va">msd2_param_list</span><span class="op">$</span><span class="va">J</span>,
  state_names <span class="op">=</span> <span class="va">msd2_param_list</span><span class="op">$</span><span class="va">state_names</span>,
  state_colors <span class="op">=</span> <span class="va">msd2_param_list</span><span class="op">$</span><span class="va">state_colors</span>,
  init <span class="op">=</span> <span class="va">msd2_param_list</span><span class="op">$</span><span class="va">init</span>, 
  transition <span class="op">=</span> <span class="va">msd2_param_list</span><span class="op">$</span><span class="va">transition</span>,
  sojourn <span class="op">=</span> <span class="va">msd2_param_list</span><span class="op">$</span><span class="va">sojourn</span>,
  marg_em_probs <span class="op">=</span> <span class="va">msd2_param_list</span><span class="op">$</span><span class="va">marg_em_probs</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">msd1</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sojourn distributions specified as Gamma distributions for both state."</span><span class="op">)</span>

<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">msd2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sojourn distributions specified as Poisson (A) and Gamma (B)"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/msd1-2-specified-sojourn-viz-1.png" width="768"></p>
<p>Simulations from these two models lead to very similar sequences.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">X1</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">msd1</span>, seed <span class="op">=</span> <span class="fl">10</span>, n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="va">X2</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">msd2</span>, seed <span class="op">=</span> <span class="fl">10</span>, n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>

<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X1</span>, model <span class="op">=</span> <span class="va">msd1</span>, 
                   compact_view <span class="op">=</span> <span class="cn">TRUE</span>,
                   title <span class="op">=</span> <span class="st">"Sojourn distributions specified as Gamma for both states"</span><span class="op">)</span>
<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X2</span>, model <span class="op">=</span> <span class="va">msd2</span>, 
                   compact_view <span class="op">=</span> <span class="cn">TRUE</span>,
                   title <span class="op">=</span> <span class="st">"Sojourn distributions specified as Poisson (A) and Gamma (B)"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/msd1-2-simulated-1.png" width="768"></p>
<p>However, when fitting the model to the sequences, the fitted sojourns become different depending on how they have been specified.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">msd1_fitted</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">msd1</span>, X <span class="op">=</span> <span class="va">X1</span><span class="op">)</span>
<span class="va">msd2_fitted</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">msd2</span>, X <span class="op">=</span> <span class="va">X1</span><span class="op">)</span>

<span class="va">g0</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">msd1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Specified sojourn distributions"</span><span class="op">)</span>
<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">msd1_fitted</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Fitted sojourn distributions specified as Gamma distributions for both states"</span><span class="op">)</span>
<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">msd2_fitted</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Fitted sojourn distributions specified as Poisson (A) and Gamma (B) distributions"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g0</span>, <span class="va">g1</span>, <span class="va">g2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/msd1-2-fit-1.png" width="672"></p>
</div>
</div>
<div id="modelling-missing-data-censoring-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#modelling-missing-data-censoring-probabilities" class="anchor"></a>Modelling missing data: censoring probabilities</h2>
<p>In this section, we will demonstrate the different options of to model or account for missing data. In this package, the probabilities of missing data can be specified in two ways: (1) one can specify the probability that <strong>all variables</strong> are missing at a given time-point in each state (missing time-points), and (2) one can specify the probability that <strong>a specific variable</strong> is missing at a given time-point in each state.</p>
<p>Censoring probabilities are specified with a list of two elements, <code>p</code> and <code>q</code>. <code>p</code> is a vector of length <code>J</code> with the probability of missing time-points in each state, while <code>q</code> is a matrix of dimension <code>NV x J</code> where <code>J</code> is the number of states and <code>NV</code> the number of variables.</p>
<p><span class="math display">\[p_j = P(\mathbf{X} = \varnothing | S = j)\]</span></p>
<p><span class="math display">\[q_{k,j} = P(X_k =  \varnothing  |  S = j) \]</span></p>
<p>If the censoring probabilities are not specified, sequences are simulated assuming data are never missing, but sequences with missing data can still be decoded and the most likely sequence of hidden state is predicted assuming that variables are missing at random with a probability of 0.5 in all states.</p>
<p>We use the examples below to illustrate these differences.</p>
<div id="modelling-the-absence-of-missing-data" class="section level3">
<h3 class="hasAnchor">
<a href="#modelling-the-absence-of-missing-data" class="anchor"></a>Modelling the absence of missing data</h3>
<p>Here, we compare two models. In the first model (<code>mm1</code>), the censoring (missing) probabilities are not specified and in the second model (<code>mm2</code>), the censoring probabilities are specified such that there are no missing time-points.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">mm1_param_list</span> <span class="op">=</span> <span class="va">m1</span>
<span class="va">mm1_param_list</span><span class="op">$</span><span class="va">censoring_probs</span> <span class="op">=</span> <span class="cn">NULL</span>

<span class="va">mm1</span> <span class="op">=</span> <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="va">mm1_param_list</span><span class="op">$</span><span class="va">J</span>,
  state_names <span class="op">=</span> <span class="va">mm1_param_list</span><span class="op">$</span><span class="va">state_names</span>,
  state_colors <span class="op">=</span> <span class="va">mm1_param_list</span><span class="op">$</span><span class="va">state_colors</span>,
  init <span class="op">=</span> <span class="va">mm1_param_list</span><span class="op">$</span><span class="va">init</span>, 
  transition <span class="op">=</span> <span class="va">mm1_param_list</span><span class="op">$</span><span class="va">transition</span>,
  sojourn <span class="op">=</span> <span class="va">mm1_param_list</span><span class="op">$</span><span class="va">sojourn</span>,
  marg_em_probs <span class="op">=</span> <span class="va">mm1_param_list</span><span class="op">$</span><span class="va">marg_em_probs</span>,
  censoring_probs <span class="op">=</span> <span class="va">mm1_param_list</span><span class="op">$</span><span class="va">censoring_probs</span><span class="op">)</span>


<span class="va">mm2_param_list</span> <span class="op">=</span> <span class="va">m1</span>
<span class="va">mm2_param_list</span><span class="op">$</span><span class="va">censoring_probs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="va">mm2</span> <span class="op">=</span> <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="va">mm2_param_list</span><span class="op">$</span><span class="va">J</span>,
  state_names <span class="op">=</span> <span class="va">mm2_param_list</span><span class="op">$</span><span class="va">state_names</span>,
  state_colors <span class="op">=</span> <span class="va">mm2_param_list</span><span class="op">$</span><span class="va">state_colors</span>,
  init <span class="op">=</span> <span class="va">mm2_param_list</span><span class="op">$</span><span class="va">init</span>, 
  transition <span class="op">=</span> <span class="va">mm2_param_list</span><span class="op">$</span><span class="va">transition</span>,
  sojourn <span class="op">=</span> <span class="va">mm2_param_list</span><span class="op">$</span><span class="va">sojourn</span>,
  marg_em_probs <span class="op">=</span> <span class="va">mm2_param_list</span><span class="op">$</span><span class="va">marg_em_probs</span>,
  censoring_probs <span class="op">=</span> <span class="va">mm2_param_list</span><span class="op">$</span><span class="va">censoring_probs</span><span class="op">)</span></code></pre></div>
<p>Simulating sequences with these two models lead to exactly the same sequences in which no time-point is missing.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">X1</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mm1</span>, seed <span class="op">=</span> <span class="fl">10</span>, n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="va">X2</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mm2</span>, seed <span class="op">=</span> <span class="fl">10</span>, n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>

<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X1</span>, model <span class="op">=</span> <span class="va">mm1</span>, compact_view <span class="op">=</span> <span class="cn">TRUE</span>, 
                   title <span class="op">=</span> <span class="st">"Missing probabilities not specified"</span><span class="op">)</span>
<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X2</span>, model <span class="op">=</span> <span class="va">mm2</span>, compact_view <span class="op">=</span> <span class="cn">TRUE</span>, 
                   title <span class="op">=</span> <span class="st">"Missing probabilities specified to 0"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/no-missing-simulate-1.png" width="768"></p>
<p>The difference between these two models is that the probability of missing time-points was explicitly specified to 0 in <code>mm2</code>. Therefore, <code>mm2</code> is unable to decode time-series in which time-points are missing. On the other hand, since the missing probabilities were not specified in <code>mm1</code>, our package makes the assumption that each variable could be missing in any state.</p>
<p>To illustrate this, we modify the simulated sequence to add missing time-points and use the <code>predict_states_hsmm</code> function to decode this sequence with each model.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">X1_with_missing</span> <span class="op">=</span> <span class="va">X1</span>
<span class="va">j</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span>, <span class="fl">200</span><span class="op">)</span>
<span class="va">X1_with_missing</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
<span class="va">X1_with_missing</span><span class="op">$</span><span class="va">var2</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
<span class="va">X1_with_missing</span><span class="op">$</span><span class="va">var3</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>

<span class="co"># plot_hsmm_seq(X = X1_with_missing, model = mm1)</span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">vit1</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_states_hsmm.html">predict_states_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mm1</span>, X <span class="op">=</span> <span class="va">X1_with_missing</span>, method <span class="op">=</span> <span class="st">"Viterbi"</span><span class="op">)</span> 
<span class="co"># vit2 = predict_states_hsmm(model = mm2, X = X1_with_missing, method = "Viterbi") </span>
<span class="co"># the previous line throws an error because missing data are specified as impossible</span></code></pre></div>
<p>Below, we compare the predicted hidden states on the sequence with or without missing variables.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">vit1_no_missing</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_states_hsmm.html">predict_states_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mm1</span>, X <span class="op">=</span> <span class="va">X1</span>, method <span class="op">=</span> <span class="st">"Viterbi"</span><span class="op">)</span>

<span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X1_with_missing</span> <span class="op">%&gt;%</span> 
                <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, 
                          <span class="va">vit1</span><span class="op">$</span><span class="va">state_seq</span> <span class="op">%&gt;%</span> 
                            <span class="fu">rename</span><span class="op">(</span>state_Vitebi_with_missing_tp <span class="op">=</span> <span class="va">state</span><span class="op">)</span>,
                          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seq_id"</span>, <span class="st">"t"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
                <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, 
                          <span class="va">vit1_no_missing</span><span class="op">$</span><span class="va">state_seq</span> <span class="op">%&gt;%</span> 
                            <span class="fu">rename</span><span class="op">(</span>state_Vitebi_without_missing_tp <span class="op">=</span> <span class="va">state</span><span class="op">)</span>,
                          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seq_id"</span>, <span class="st">"t"</span><span class="op">)</span><span class="op">)</span> ,
              model <span class="op">=</span> <span class="va">mm1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/no-missing-comparison-1.png" width="768"></p>
<p>Because the number of missing time-point was limited, the predicted sequence of hidden states is very similar when predicted from the sequence with or without missing time-points.</p>
<p>When a model in which the missing probabilities are not specified is fitted to a sequence with missing time-points, the missing probabilities are learned from the sequence.</p>
<p>To illustrate this, we modify again the original simulated sequence, this time, making sure to remove time-points only in state “B”.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">X1_with_missing_B</span> <span class="op">=</span> <span class="va">X1</span>
<span class="va">j</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">X1</span><span class="op">$</span><span class="va">state</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span>, <span class="fl">150</span><span class="op">)</span>
<span class="va">X1_with_missing_B</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
<span class="va">X1_with_missing_B</span><span class="op">$</span><span class="va">var2</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
<span class="va">X1_with_missing_B</span><span class="op">$</span><span class="va">var3</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>

<span class="va">mm1_fitted</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span><span class="va">mm1</span>, X <span class="op">=</span> <span class="va">X1_with_missing_B</span><span class="op">)</span>


<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_marg_dist.html">plot_hsmm_marg_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mm1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Marginal emission probabilities of the specified model"</span><span class="op">)</span>
<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_marg_dist.html">plot_hsmm_marg_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mm1_fitted</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Marginal emission probabilities of the fitted model"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/no-missing-fit-1.png" width="672"></p>
<p>In the bottom plot, the transparency of the histograms reflects a higher probability of the variables being missing in state 2 (B).</p>
</div>
<div id="modelling-state-specific-missing-time-points" class="section level3">
<h3 class="hasAnchor">
<a href="#modelling-state-specific-missing-time-points" class="anchor"></a>Modelling state-specific missing time-points</h3>
<p>To model that time-points may be more frequently missing in some states, the missing probability <span class="math inline">\(p\)</span> can be specified with a vector of length <span class="math inline">\(J\)</span>.</p>
<p>Here, we compare the sequences simulated with two models: <code>mm1</code> in which the missing probabilities are not specified and <code>mp</code> in which the missing probabilities <code>p</code> are specified such that time-points are more likely to be missing in state 2 (B) than state 1 (A).</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="va">mp_param_list</span> <span class="op">=</span> <span class="va">mm1</span>
<span class="va">mp_param_list</span><span class="op">$</span><span class="va">censoring_probs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>

<span class="va">mp</span> <span class="op">=</span> <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="va">mp_param_list</span><span class="op">$</span><span class="va">J</span>,
  state_names <span class="op">=</span> <span class="va">mp_param_list</span><span class="op">$</span><span class="va">state_names</span>,
  state_colors <span class="op">=</span> <span class="va">mp_param_list</span><span class="op">$</span><span class="va">state_colors</span>,
  init <span class="op">=</span> <span class="va">mp_param_list</span><span class="op">$</span><span class="va">init</span>, 
  transition <span class="op">=</span> <span class="va">mp_param_list</span><span class="op">$</span><span class="va">transition</span>,
  sojourn <span class="op">=</span> <span class="va">mp_param_list</span><span class="op">$</span><span class="va">sojourn</span>,
  marg_em_probs <span class="op">=</span> <span class="va">mp_param_list</span><span class="op">$</span><span class="va">marg_em_probs</span>,
  censoring_probs <span class="op">=</span> <span class="va">mp_param_list</span><span class="op">$</span><span class="va">censoring_probs</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">X1</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mm1</span>, seed <span class="op">=</span> <span class="fl">10</span>, n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="va">X2</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mp</span>, seed <span class="op">=</span> <span class="fl">10</span>, n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>

<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X1</span>, model <span class="op">=</span> <span class="va">mm1</span>, compact_view <span class="op">=</span> <span class="cn">TRUE</span>,
              title <span class="op">=</span> <span class="st">"Missing probabilities not specified"</span><span class="op">)</span>
<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X2</span>, model <span class="op">=</span> <span class="va">mp</span>, compact_view <span class="op">=</span> <span class="cn">TRUE</span>,
                   title <span class="op">=</span> <span class="st">"Missing time-point probabilities specified"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/missing-p-simulations-1.png" width="768"></p>
<p>If one fits <code>mm1</code> on the sequence simulated with <code>mp</code>, the missing probabilities are learned.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">mm1_fitted</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mm1</span>, X <span class="op">=</span> <span class="va">X2</span><span class="op">)</span>

<span class="va">mm1_fitted</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">obs_probs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">var1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">var2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">var3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 x 6</span>
<span class="co">#&gt;   state var1   var2 var3      p    p0</span>
<span class="co">#&gt;   &lt;int&gt; &lt;fct&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1 &lt;NA&gt;     NA &lt;NA&gt;  0.208     0</span>
<span class="co">#&gt; 2     2 &lt;NA&gt;     NA &lt;NA&gt;  0.477     0</span></code></pre></div>
</div>
<div id="modeling-state-specific-missing-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#modeling-state-specific-missing-variables" class="anchor"></a>Modeling state-specific missing variables</h3>
<p>Instead of modeling the missing probabilities of a complete time-point, one can specify the missing probabilities of specific variables in specific states.</p>
<p>Here we compare three models to illustrate the impact of changing <code>p</code> or <code>q</code> when specifying the missing probabilities.</p>
<p>In <code>mq1</code>, the probability of missing time-points (<code>p</code>) is specified such that time-points are missing with a probability of 0.2 in state 1 (A) and 0.5 in state 2 (B). The individual probability of missing variables is set to 0. Altogether, that means that if one variable is missing, they are all missing. If one is observed, they are all observed.</p>
<p>In <code>mq2</code>, the probability of missing time-points is set to 0, but the probabilities of missing variables is specified such that they are all missing with the same probability given the state. This means that one variable could be missing while the others are present. And that their missingness is independent (they could all be missing with a probability equal to the product of each being missing).</p>
<p>In <code>mq3</code>, the probability of missing time-points is also set to 0, while each variable may be missing with a specific probability. In comparison with <code>mq2</code> where all variables had the same missing probabilities given the state, here one variable is more likely to be missing in one state, while the second variable is more likely to be missing in another state.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">mq1_param_list</span> <span class="op">=</span> <span class="va">m1</span>
<span class="va">mq1_param_list</span><span class="op">$</span><span class="va">censoring_probs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>

<span class="va">mq1</span> <span class="op">=</span> <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="va">mq1_param_list</span><span class="op">$</span><span class="va">J</span>,
  state_names <span class="op">=</span> <span class="va">mq1_param_list</span><span class="op">$</span><span class="va">state_names</span>,
  state_colors <span class="op">=</span> <span class="va">mq1_param_list</span><span class="op">$</span><span class="va">state_colors</span>,
  init <span class="op">=</span> <span class="va">mq1_param_list</span><span class="op">$</span><span class="va">init</span>, 
  transition <span class="op">=</span> <span class="va">mq1_param_list</span><span class="op">$</span><span class="va">transition</span>,
  sojourn <span class="op">=</span> <span class="va">mq1_param_list</span><span class="op">$</span><span class="va">sojourn</span>,
  marg_em_probs <span class="op">=</span> <span class="va">mq1_param_list</span><span class="op">$</span><span class="va">marg_em_probs</span>,
  censoring_probs <span class="op">=</span> <span class="va">mq1_param_list</span><span class="op">$</span><span class="va">censoring_probs</span><span class="op">)</span>


<span class="va">mq2_param_list</span> <span class="op">=</span> <span class="va">m1</span>
<span class="va">mq2_param_list</span><span class="op">$</span><span class="va">censoring_probs</span> <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
  q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.5</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.5</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">mq2</span> <span class="op">=</span> <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="va">mq2_param_list</span><span class="op">$</span><span class="va">J</span>,
  state_names <span class="op">=</span> <span class="va">mq2_param_list</span><span class="op">$</span><span class="va">state_names</span>,
  state_colors <span class="op">=</span> <span class="va">mq2_param_list</span><span class="op">$</span><span class="va">state_colors</span>,
  init <span class="op">=</span> <span class="va">mq2_param_list</span><span class="op">$</span><span class="va">init</span>, 
  transition <span class="op">=</span> <span class="va">mq2_param_list</span><span class="op">$</span><span class="va">transition</span>,
  sojourn <span class="op">=</span> <span class="va">mq2_param_list</span><span class="op">$</span><span class="va">sojourn</span>,
  marg_em_probs <span class="op">=</span> <span class="va">mq2_param_list</span><span class="op">$</span><span class="va">marg_em_probs</span>,
  censoring_probs <span class="op">=</span> <span class="va">mq2_param_list</span><span class="op">$</span><span class="va">censoring_probs</span><span class="op">)</span>


<span class="va">mq3_param_list</span> <span class="op">=</span> <span class="va">m1</span>
<span class="va">mq3_param_list</span><span class="op">$</span><span class="va">censoring_probs</span> <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
  q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.2</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.5</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">mq3</span> <span class="op">=</span> <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="va">mq3_param_list</span><span class="op">$</span><span class="va">J</span>,
  state_names <span class="op">=</span> <span class="va">mq3_param_list</span><span class="op">$</span><span class="va">state_names</span>,
  state_colors <span class="op">=</span> <span class="va">mq3_param_list</span><span class="op">$</span><span class="va">state_colors</span>,
  init <span class="op">=</span> <span class="va">mq3_param_list</span><span class="op">$</span><span class="va">init</span>, 
  transition <span class="op">=</span> <span class="va">mq3_param_list</span><span class="op">$</span><span class="va">transition</span>,
  sojourn <span class="op">=</span> <span class="va">mq3_param_list</span><span class="op">$</span><span class="va">sojourn</span>,
  marg_em_probs <span class="op">=</span> <span class="va">mq3_param_list</span><span class="op">$</span><span class="va">marg_em_probs</span>,
  censoring_probs <span class="op">=</span> <span class="va">mq3_param_list</span><span class="op">$</span><span class="va">censoring_probs</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">X1</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mq1</span>, seed <span class="op">=</span> <span class="fl">10</span>, n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="va">X2</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mq2</span>, seed <span class="op">=</span> <span class="fl">10</span>, n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="va">X3</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mq3</span>, seed <span class="op">=</span> <span class="fl">10</span>, n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>

<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X1</span>, model <span class="op">=</span> <span class="va">mq1</span>, compact_view <span class="op">=</span> <span class="cn">TRUE</span>,
                   title <span class="op">=</span> <span class="st">"Time-point missing probability specified"</span><span class="op">)</span>
<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X2</span>, model <span class="op">=</span> <span class="va">mq2</span>, compact_view <span class="op">=</span> <span class="cn">TRUE</span>,
                   title <span class="op">=</span> <span class="st">"Variable-specific missing probability specified (all variables have identical missing prob.)"</span><span class="op">)</span>
<span class="va">g3</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_seq.html">plot_hsmm_seq</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X3</span>, model <span class="op">=</span> <span class="va">mq3</span>, compact_view <span class="op">=</span> <span class="cn">TRUE</span>,
                   title <span class="op">=</span> <span class="st">"Variable-specific missing probability specified"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g1</span>,<span class="va">g2</span>,<span class="va">g3</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/missing-q-simulate-1.png" width="768"> Each of these models can be fitted on the sequences simulated from the other models and missing probabilities are learned. See the two examples below.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">mq2_fitted_to_X1</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mq2</span>, X <span class="op">=</span> <span class="va">X1</span>, N0 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">mq2_fitted_to_X1</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">obs_probs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">var1</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">var3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   state var1   var2 var3      p     p0</span>
<span class="co">#&gt;   &lt;int&gt; &lt;fct&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1 &lt;NA&gt;      0 &lt;NA&gt;  0     0.0256</span>
<span class="co">#&gt; 2     1 &lt;NA&gt;      1 &lt;NA&gt;  0     0.0064</span>
<span class="co">#&gt; 3     1 &lt;NA&gt;     NA &lt;NA&gt;  0.206 0.008 </span>
<span class="co">#&gt; 4     2 &lt;NA&gt;      0 &lt;NA&gt;  0     0.0250</span>
<span class="co">#&gt; 5     2 &lt;NA&gt;      1 &lt;NA&gt;  0     0.1   </span>
<span class="co">#&gt; 6     2 &lt;NA&gt;     NA &lt;NA&gt;  0.478 0.125</span>


<span class="va">mq2_fitted_to_X3</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mq2</span>, X <span class="op">=</span> <span class="va">X3</span>, N0 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">mq2_fitted_to_X3</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">obs_probs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">var1</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">var3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   state var1   var2 var3      p     p0</span>
<span class="co">#&gt;   &lt;int&gt; &lt;fct&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1 &lt;NA&gt;      0 &lt;NA&gt;      0 0.0256</span>
<span class="co">#&gt; 2     1 &lt;NA&gt;      1 &lt;NA&gt;      0 0.0064</span>
<span class="co">#&gt; 3     1 &lt;NA&gt;     NA &lt;NA&gt;      0 0.008 </span>
<span class="co">#&gt; 4     2 &lt;NA&gt;      0 &lt;NA&gt;      0 0.0250</span>
<span class="co">#&gt; 5     2 &lt;NA&gt;      1 &lt;NA&gt;      0 0.1   </span>
<span class="co">#&gt; 6     2 &lt;NA&gt;     NA &lt;NA&gt;      0 0.125</span></code></pre></div>
</div>
</div>
<div id="prior-distributions-for-emission-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#prior-distributions-for-emission-probabilities" class="anchor"></a>Prior distributions for emission probabilities</h2>
<p>If models can only be fitted on small multi-variate sequences, it may happen that these sequences do not have all possible combination of variables values and that some rare combinations may be learned to have a zero-probability. This would throw an error if this combination is later found in a new sequence that needs to be fitted or simply decoded.</p>
<p>To prevent such event, one can use the option <code>N0</code> from the <code><a href="../reference/fit_hsmm.html">fit_hsmm()</a></code> function. This option takes as input an integer which specify the strength of the initial emission probabilities in terms of prior sample size. When emission probabilities are updated during the M-step, the observed emission probabilities are weighted with the prior emission probabilities (those of the model provided as input for the fit) with a weight ratio of <code>N/N0</code> where <code>N</code> is the number of observations in the provided sequence for the fit.</p>
<p>For example, if the model is fitted on a sequence of length 500 and <code>N0</code> is set to 500, then the prior and observed probabilities have the same weight when emission probabilities are re-estimated. If <code>N0</code> were 1000, prior probabilities would weight twice as much.</p>
<p>We illustrate this with an example comparing three fits on a small sequence.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># we simulate a small sequence that the model will be fitted on</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">small_X</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1</span>, n_state_transitions <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="co"># and another small sequence which we will decode with the fitted model</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">future_X</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1</span>, n_state_transitions <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>


<span class="co"># we modify the sequences so that the model can learn the emission probabilities</span>
<span class="co"># and we can evaluate the effect of the prior</span>
<span class="va">small_X</span> <span class="op">=</span> <span class="va">small_X</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>var1 <span class="op">=</span> <span class="va">var1</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span>

<span class="va">future_X</span> <span class="op">=</span> <span class="va">future_X</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>var1 <span class="op">=</span> <span class="va">var1</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span>

<span class="co"># we fit the model to the sequence using different prior strength</span>
<span class="va">m1_fitted_no_prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1</span>, X <span class="op">=</span> <span class="va">small_X</span>, N0 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">m1_fitted_small_prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1</span>, X <span class="op">=</span> <span class="va">small_X</span>, N0 <span class="op">=</span> <span class="fl">0.25</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">small_X</span><span class="op">)</span><span class="op">)</span>
<span class="va">m1_fitted_equal_prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1</span>, X <span class="op">=</span> <span class="va">small_X</span>, N0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">small_X</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can now compare the initial and fitted emission probabilities</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">g0</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_marg_dist.html">plot_hsmm_marg_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Initial emission probabilities"</span><span class="op">)</span>
<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_marg_dist.html">plot_hsmm_marg_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1_fitted_no_prior</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Fitted emission probabilities (no prior)"</span><span class="op">)</span>
<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_marg_dist.html">plot_hsmm_marg_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1_fitted_small_prior</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Fitted emission probabilities (small prior)"</span><span class="op">)</span>
<span class="va">g3</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_marg_dist.html">plot_hsmm_marg_dist</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1_fitted_equal_prior</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Fitted emission probabilities (equal prior)"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g0</span>, <span class="va">g1</span>, <span class="va">g2</span>, <span class="va">g3</span>,
          ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/prior-on-emission-comparing-emission-probs-1.png" width="768"></p>
<p>And we can attempt to decode a new time-series with these fitted models:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># this one will throw an error</span>
<span class="co"># vit = predict_states_hsmm(model = m1_fitted_no_prior$model, </span>
<span class="co">#                           X = future_X, method = "Viterbi")</span>

<span class="co"># the next ones run fine.</span>
<span class="va">vit</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_states_hsmm.html">predict_states_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1_fitted_small_prior</span><span class="op">$</span><span class="va">model</span>, 
                          X <span class="op">=</span> <span class="va">future_X</span>, method <span class="op">=</span> <span class="st">"Viterbi"</span><span class="op">)</span>
<span class="va">vit</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_states_hsmm.html">predict_states_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">m1_fitted_equal_prior</span><span class="op">$</span><span class="va">model</span>, 
                          X <span class="op">=</span> <span class="va">future_X</span>, method <span class="op">=</span> <span class="st">"Viterbi"</span><span class="op">)</span></code></pre></div>
</div>
<div id="semi-supervised-learning" class="section level2">
<h2 class="hasAnchor">
<a href="#semi-supervised-learning" class="anchor"></a>(semi-)Supervised learning</h2>
<p>While hidden semi-Markov models are mostly used in unsupervised set-ups, this package allows to fit and decode sequences when (partial) ground-truth is provided. Both functions (<code><a href="../reference/fit_hsmm.html">fit_hsmm()</a></code> and <code><a href="../reference/predict_states_hsmm.html">predict_states_hsmm()</a></code>) have a <code>ground_truth</code> options which takes as argument a 3-column <code>data.frame</code> which define the hidden state sequence for specific sequences and time-points.</p>
<p>To illustrate the benefits of this options, we first define a 3-state 1-variable generative model from which we simulate 5 sequences. We then mask the sequence of hidden state such that our partial ground-truth covers ~ 10% of the time-series. We then define a generic 3-state model and fit this model to the generated sequence twice: in one case, we provide the partial ground-truth and in the other case we do not provide any ground truth. We then compare the two fitted model to the original generative model.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">unknown_generative_model</span> <span class="op">=</span> 
  <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
    J <span class="op">=</span> <span class="fl">3</span>, 
    init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>,
    transition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    sojourn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"gamma"</span>,
                   shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">10</span>,<span class="fl">5</span><span class="op">)</span>,
                   scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
    marg_em_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      var1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        type <span class="op">=</span> <span class="st">"norm"</span>,
        params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,
                      sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>

<span class="co"># plot_hsmm_seq(X = simulate_hsmm(model = unknown_generative_model,</span>
<span class="co">#                   n_state_transitions = 20), </span>
<span class="co">#               model = unknown_generative_model,</span>
<span class="co">#               add_state_color_legend = TRUE)</span>

<span class="va">ground_truth</span> <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span>
  .x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
  .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="../reference/simulate_hsmm.html">simulate_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">unknown_generative_model</span>,
                  seq_id <span class="op">=</span> <span class="va">i</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="op">)</span>,
                  n_state_transitions <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">)</span>

<span class="va">X</span> <span class="op">=</span> <span class="va">ground_truth</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">state</span><span class="op">)</span> <span class="co"># observed sequence</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">j</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ground_truth</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">0.90</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ground_truth</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">masked_ground_truth</span> <span class="op">=</span> <span class="va">ground_truth</span>
<span class="va">masked_ground_truth</span><span class="op">$</span><span class="va">state</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
<span class="va">partial_ground_truth</span> <span class="op">=</span> <span class="va">ground_truth</span><span class="op">[</span><span class="op">-</span><span class="va">j</span>,<span class="op">]</span>

<span class="co"># for(sid in unique(masked_ground_truth$seq_id)){</span>
<span class="co">#   plot_hsmm_seq(X = masked_ground_truth %&gt;% filter(seq_id == sid),</span>
<span class="co">#                 model = unknown_generative_model) %&gt;% </span>
<span class="co">#     print()</span>
<span class="co"># }</span></code></pre></div>
<p>From the partial ground truth, we know that there are 3 states and we can estimate the mean and variance of the variable in each state. However, from this partial ground truth, it is difficult to estimate the transition probabilities or the sojourn distributions.</p>
<p>The generic model is specified thus such that transitions are possible between all three states and such that sojourn distributions are identical in all three states. Emissing parameters are estimated from the partial ground truth. We then fit this model to the observations, using or not the partial ground truth.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">var1_mean_and_sd_from_partial_ground_truth</span> <span class="op">=</span> 
  <span class="va">masked_ground_truth</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarize</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">var1</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, 
            sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">var1</span>, na.rm <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, 
            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span>

<span class="va">model_to_fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/specify_hsmm.html">specify_hsmm</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="fl">3</span>,
  init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>,
  transition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">3</span>,byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
  sojourn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"ksmoothed_nonparametric"</span>,
                 d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, shape <span class="op">=</span> <span class="fl">1.5</span>, scale <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,
                           <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, shape <span class="op">=</span> <span class="fl">1.5</span>, scale <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,
                           <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, shape <span class="op">=</span> <span class="fl">1.5</span>, scale <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
  marg_em_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    var1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      type <span class="op">=</span> <span class="st">"norm"</span>,
      params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">var1_mean_and_sd_from_partial_ground_truth</span><span class="op">$</span><span class="va">mean</span>,
                    sd <span class="op">=</span> <span class="va">var1_mean_and_sd_from_partial_ground_truth</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; Warning in .check_sojourn_all_states(sojourn, J): The provided sojourn</span>
<span class="co">#&gt; distributions do not sum to 1 for at least one state. Sojourn distributions are</span>
<span class="co">#&gt; normalized so that they sum to 1.</span>

<span class="va">fitted_model_without_ground_truth</span> <span class="op">=</span> 
  <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">model_to_fit</span>, X <span class="op">=</span> <span class="va">X</span>,
           rel_tol <span class="op">=</span> <span class="fl">1e-5</span>, n_iter <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">fitted_model_with_ground_truth</span> <span class="op">=</span> 
  <span class="fu"><a href="../reference/fit_hsmm.html">fit_hsmm</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">model_to_fit</span>, X <span class="op">=</span> <span class="va">X</span>, 
           ground_truth <span class="op">=</span> <span class="va">partial_ground_truth</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">var1</span><span class="op">)</span>,
           trust_in_ground_truth <span class="op">=</span> <span class="fl">1</span>,
           rel_tol <span class="op">=</span> <span class="fl">1e-5</span>, n_iter <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>We can now compare the two fitted models. First, we compare the likelihood and number of iterations of the EM algorithm needed to reach convergence. We can do this using the <code><a href="../reference/plot_hsmm_fit_status.html">plot_hsmm_fit_status()</a></code> function.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_fit_status.html">plot_hsmm_fit_status</a></span><span class="op">(</span><span class="va">fitted_model_without_ground_truth</span>, 
                     title <span class="op">=</span> <span class="st">"Convergence of model fitted without partial ground-truth"</span><span class="op">)</span>
<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_fit_status.html">plot_hsmm_fit_status</a></span><span class="op">(</span><span class="va">fitted_model_with_ground_truth</span>,
                     title <span class="op">=</span> <span class="st">"Convergence of model fitted with partial ground-truth"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/supervised-fit-status-1.png" width="576"></p>
<p>The fit converges faster when partial ground-truth is provided.</p>
<p>We can then compare the emission probabilities. We expect here both model to perform similarly given that the estimates from the partial ground-truth were already good estimates.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">g0</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_marg_dist.html">plot_hsmm_marg_dist</a></span><span class="op">(</span><span class="va">unknown_generative_model</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Emission probabilities of the generative model"</span><span class="op">)</span>
<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_marg_dist.html">plot_hsmm_marg_dist</a></span><span class="op">(</span><span class="va">fitted_model_without_ground_truth</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Emission probabilities of the fitted model (no ground truth)"</span><span class="op">)</span>
<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_marg_dist.html">plot_hsmm_marg_dist</a></span><span class="op">(</span><span class="va">fitted_model_with_ground_truth</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Emission probabilities of the fitted model (partial ground truth)"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g0</span>, <span class="va">g1</span>, <span class="va">g2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/supervised-marg-dist-1.png" width="576"></p>
<p>We now compare the sojourn distributions.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">g0</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span><span class="va">unknown_generative_model</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sojourn distributions of the generative model"</span><span class="op">)</span>
<span class="va">g1</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span><span class="va">fitted_model_without_ground_truth</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sojourn distributions of the fitted model (no ground truth)"</span><span class="op">)</span>
<span class="va">g2</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_hsmm_sojourn_dist.html">plot_hsmm_sojourn_dist</a></span><span class="op">(</span><span class="va">fitted_model_with_ground_truth</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sojourn distributions of the fitted model (partial ground truth)"</span><span class="op">)</span>

<span class="fu">ggarrange</span><span class="op">(</span><span class="va">g0</span>, <span class="va">g1</span>, <span class="va">g2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="HiddenSemiMarkov_files/figure-html/supervised-sojourn-1.png" width="672"> We then compare the transition probabilities matrices.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">unknown_generative_model</span><span class="op">$</span><span class="va">transition</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">.</span>,<span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]    0    1    0</span>
<span class="co">#&gt; [2,]    0    0    1</span>
<span class="co">#&gt; [3,]    1    0    0</span>
<span class="va">fitted_model_without_ground_truth</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">transition</span>  <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">.</span>,<span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,] 0.00 1.00    0</span>
<span class="co">#&gt; [2,] 0.00 0.00    1</span>
<span class="co">#&gt; [3,] 0.95 0.05    0</span>
<span class="va">fitted_model_with_ground_truth</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">transition</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">.</span>,<span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]    0    1    0</span>
<span class="co">#&gt; [2,]    0    0    1</span>
<span class="co">#&gt; [3,]    1    0    0</span>

<span class="co"># g0 = plot_hsmm_transitions(unknown_generative_model) +</span>
<span class="co">#   ggtitle("Transition probabilities of the generative model")</span>
<span class="co"># g1 = plot_hsmm_transitions(fitted_model_without_ground_truth$model) +</span>
<span class="co">#   ggtitle("Transition probabilities of the fitted model (no ground truth)")</span>
<span class="co"># g2 = plot_hsmm_transitions(fitted_model_with_ground_truth$model) +</span>
<span class="co">#   ggtitle("Transition probabilities of the fitted model (partial ground truth)")</span>
<span class="co"># </span>
<span class="co"># ggarrange(g0, g1, g2, ncol = 1)</span></code></pre></div>
<p>And finally, we compare the accuracy of the hidden state prediction with both fitted model.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">vit_without_GT</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_states_hsmm.html">predict_states_hsmm</a></span><span class="op">(</span>
  model <span class="op">=</span> <span class="va">fitted_model_without_ground_truth</span><span class="op">$</span><span class="va">model</span>,
  X <span class="op">=</span> <span class="va">X</span>, 
  method <span class="op">=</span> <span class="st">"Viterbi"</span><span class="op">)</span>


<span class="va">vit_with_GT</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_states_hsmm.html">predict_states_hsmm</a></span><span class="op">(</span>
  model <span class="op">=</span> <span class="va">fitted_model_with_ground_truth</span><span class="op">$</span><span class="va">model</span>,
  X <span class="op">=</span> <span class="va">X</span>, 
  method <span class="op">=</span> <span class="st">"Viterbi"</span><span class="op">)</span>

<span class="va">RES</span> <span class="op">=</span> <span class="va">ground_truth</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>,
            <span class="va">vit_without_GT</span><span class="op">$</span><span class="va">state_seq</span> <span class="op">%&gt;%</span> <span class="fu">rename</span><span class="op">(</span>state_vit_without_GT <span class="op">=</span> <span class="va">state</span><span class="op">)</span>,
            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seq_id"</span>,<span class="st">"t"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>,
            <span class="va">vit_with_GT</span><span class="op">$</span><span class="va">state_seq</span> <span class="op">%&gt;%</span> <span class="fu">rename</span><span class="op">(</span>state_vit_with_GT <span class="op">=</span> <span class="va">state</span><span class="op">)</span>,
            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seq_id"</span>,<span class="st">"t"</span><span class="op">)</span><span class="op">)</span>
  </code></pre></div>
<p>The accuracy of the hidden state prediction is slightly increased when partial ground-truth is provided (91 vs 90).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Laura Symul.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
